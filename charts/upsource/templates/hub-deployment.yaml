apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
  labels:
    app-service: hub
  name: hub
spec:
  replicas: 1
  selector:
    matchLabels:
      app-service: hub
  strategy:
    type: Recreate
  template:
    metadata:
      annotations:
      labels:
        app-network/upsource-net-name: "true"
        app-service: hub
    spec:
      containers:
        - env:
        {{- if .Values.hub.upsourceSubnet }}
            - name: UPSOURCE_SUBNET
              value: {{ .Values.hub.upsourceSubnet }}
        {{- end }}
        {{- if .Values.hub.constraint }}
            - name: constraint
              value: node=={{ .Values.hub.constraint }}
        {{- end }}
          image: {{ .Values.global.image.prefix }}{{ .Values.hub.image.repository }}:{{ .Values.hub.image.tag }}
          imagePullPolicy: {{ .Values.hub.image.pullPolicy | quote }}
          name: hub
          ports:
            - containerPort: {{ .Values.hub.service.port }}
          resources: {}
          volumeMounts:
            - name: hub-claim0
              mountPath: /opt/hub/data
              subPath: data
            - name: hub-claim0
              mountPath: /opt/hub/conf
              subPath: conf
            - name: hub-claim0
              mountPath: /opt/hub/logs
              subPath: logs
            - name: hub-claim0
              mountPath: /opt/hub/backups
              subPath: backups
      restartPolicy: Always
      securityContext:
        runAsUser: 13001
        fsGroup: 13001
      volumes:
        - name: hub-claim0
          persistentVolumeClaim:
            claimName: hub-claim0
status: {}
